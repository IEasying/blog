title: margin系列之圣杯拾遗
date: 2016-4-27 11:15:00
categories: CSS
author: 杜瑶
tags: [margin, w3c, margin layout, 圣杯布局, holy grail]
---

## 接续

我回翻了一下之前的几篇文章，发现在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 中还有些问题没说完，所以准备补全一下。

不过这2篇文章的时间的跨度有点，在阅读本文之前，大家可以先翻读一下3年前的那篇文章。

## 没填完的坑

在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 一文结尾时，我们谈到了圣杯布局，说这个布局的实现本身存在了一些问题：“在IE6/7下报废，不过不用慌，因为它可被修复”。

我一直以为写完了，然而今天看了下发现还有坑没填。所以本文会讲讲这些问题是什么以及如何修复。

<!--more-->

## 圣杯布局的一些谈资

下面节选一段来自网路上对圣杯的描述（略有调整）：

> 圣杯是宗教传说中的圣物，耶稣曾经用这个杯子吩咐门徒喝下里面象征他的血的红葡萄酒，借此创立了受难纪念仪式。因为这个特殊的原因，后来有些人认为这个杯子具有某种神奇的能力。很多传说相信，如果能找到这个圣杯而喝下其盛过的水就将返老还童、死而复生并且获得永生，这个传说广泛延续到很多文学、影视、游戏等作品中。

而所谓的圣杯布局也并不是一个具象的形容，更多的是指借希望于它能够实现某种特殊的布局。

这种特殊布局的需求是：侧边栏宽度固定，主内容栏宽度自适应，并且需要将主内容栏放在侧边栏前面，以便优先渲染（不论是两栏或者三栏，需求都是一样的）。

## 遗留的问题

在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 里，我们用圣杯布局做了 `图0` 的效果。

![图0：classsic layout](http://demo.doyoe.com/css/margin/images/layout-1.png)

相信对于这样一个网页呈现，你不会陌生。那么你有多少种方案可以达成该布局？我想，4至5种应该是保守估计吧？

恩，HTML当然是使用主内容优先显示的那种：

### HTML

    <header id="hd">头部</header>
    <div id="bd">
        <div id="main">主内容栏自适应宽度</div>
        <aside id="aside">侧边栏固定宽度</aside>
    </div>
    <footer id="ft">底部</footer>

### CSS

    #bd{
        padding-left:210px;
    }
    #aside{
        float:left;
        position:relative;
        left:-210px;
        width:200px;
        margin-left:-100%;
    }
    #main{
        float:left;
        width:100%;
    }

如上代码，既是圣杯布局的核心Code，如果你看懂了，你会发现，这其实很简单，不是么？

简单解释一下上面的CSS Code，首先我们是在做一个左侧固定宽度，右侧自适应宽度的布局。我们说过要让块级元素在同行显示的条件：改变显示方式，改变流方式，这里我们选择了使用 `float` 来将 `#main` 和 `#aside` 变成浮动流。

OK，这时我们具备 `#main` 和 `#aside` 能在同行显示的前置条件。我们知道，浮动元素其宽度如果没有显式定义，则由其内容决定。正好，`#aside` 是定宽的，所以显示给它定义 `width:200px`，但此时 `#main` 该怎么办？不设置 `width` 不对，因为宽度将被内容左右，设置 `width:100%` 也不对，因为这样的话，就没有 `#aside` 的立足之地了，正确的应该是 `width: calc(100% - 200px)`，不是么？可惜，这是新特性，只好作罢。

变通？是的，有的时候稍微换个思路，你会觉得豁然开朗。

`#main` 不是要自适应吗？那就给它个 `100%`，怎么做？我们在包含块 `#bd` 中就将 `#aside` 的宽度刨除，宽度全部都给 `#main`。恩，我们只需要这样 `#bd{padding-left:210px;}` （10px仍然是用来做间隙的），这时 `#main` 就可以设置 `width:100%` 了，由于 `#bd` 设置了 `padding`，所以已在左边预留出了一块宽 `210px` 的区域。此时的问题在于如果将 `#aside` 挪到这个地方，你想对了，我们是在聊 `负margin` 布局，自然需要利用上。

`#aside{margin-left:-100%;}` 这样可以了吗？很明显，这样还不行，此时 `#aside` 和 `#main` 的起始位置将会重合，因为 `#aside` 的 `margin-left` 计算值是相对包含块来计算的，而此时包含块的宽度等于 `#main` 的宽度。

如何让 `#aside` 再向左偏移 `210px`？显然 `margin` 是不行了，因为我们已经用掉它了。如果你看过之前的文章的话，你可能还记得，有一篇文章讲 [margin系列之与相对偏移的异同](http://blog.doyoe.com/2013/12/02/css/margin系列之与相对偏移的异同/)。恩，是的，这时我们可以借助相对偏移。

向左偏移 `210px` 是件很简单的事：`#aside{position:relative;left:-210px;}`。

至此，你的布局OK了，这就是圣杯的实现方式。来看已实现好的示例 `DEMO8`: [圣杯：左栏固定主内容自适应](http://demo.doyoe.com/css/margin/layout/holy-grail.html)

当然，圣杯布局必须可以任意调整列顺序，要不，怎么能说是更Cool些的方案呢？

### CSS

    #bd{
        padding-right:210px;
    }
    #aside{
        float:left;
        position:relative;
        right:-210px;
        width:200px;
        margin-left:-200px;
    }
    #main{
        float:left;
        width:100%;
    }

这个就直接看示例好了，不再一一解释代码 `DEMO9`: [圣杯：右栏固定主内容自适应](http://demo.doyoe.com/css/margin/layout/holy-grail-2.html)

所以圣杯布局具备前两种方式共同的优点，同时没有他们的不足，但圣杯本身也有一些问题，在IE6/7下报废，不过不用慌，因为它可被修复。

你想到方法了吗？