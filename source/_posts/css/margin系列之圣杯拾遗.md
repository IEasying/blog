title: margin系列之圣杯拾遗
date: 2016-4-27 11:15:00
categories: CSS
author: 杜瑶
tags: [margin, w3c, margin layout, 圣杯布局, holy grail]
---

## 接续

我回翻了一下之前的几篇文章，发现在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 中还有些问题没说完，所以准备补全一下。

不过这2篇文章的时间的跨度有点，在阅读本文之前，大家可以先翻读一下3年前的那篇文章。

## 没填完的坑

在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 一文结尾时，我们谈到了圣杯布局，说这个布局的实现本身存在了一些问题：“在IE6/7下报废，不过不用慌，因为它可被修复”。

我一直以为写完了，然而今天看了下发现还有坑没填。所以本文会讲讲这些问题是什么以及如何修复。

<!--more-->

## 圣杯布局的一些谈资

下面节选一段来自网路上对圣杯的描述（略有调整）：

> 圣杯是宗教传说中的圣物，耶稣曾经用这个杯子吩咐门徒喝下里面象征他的血的红葡萄酒，借此创立了受难纪念仪式。因为这个特殊的原因，后来有些人认为这个杯子具有某种神奇的能力。很多传说相信，如果能找到这个圣杯而喝下其盛过的水就将返老还童、死而复生并且获得永生，这个传说广泛延续到很多文学、影视、游戏等作品中。

而所谓的圣杯布局也并不是一个具象的形容，更多的是指借希望于它能够实现某种特殊的布局。

这种特殊布局的需求是：侧边栏宽度固定，主内容栏宽度自适应，并且需要将主内容栏放在侧边栏前面，以便优先渲染（不论是两栏或者三栏，需求都是一样的）。

## 遗留的问题

在 [margin系列之布局篇](/2013/12/31/css/margin系列之布局篇/) 里，我们用圣杯布局做了 `图0` 的效果。

![图0：classsic layout](http://demo.doyoe.com/css/margin/images/layout-1.png)

下面是我们在上篇文章中写的圣杯布局核心代码（当然，这个 `#demo` 容器你也可以利用 `body` 来取代）：

### HTML
```html
<div id="demo">
    <header id="hd">头部</header>
    <div id="bd">
        <div id="main">主内容栏自适应宽度</div>
        <aside id="aside">侧边栏固定宽度</aside>
    </div>
    <footer id="ft">底部</footer>
</div>
```

### CSS
```css
#demo {
    width: 80%;
}
#bd {
    padding-left: 210px;
}
#main {
    float: left;
    width: 100%;
}
#aside {
    _display: inline;
    float: left;
    position: relative;
    left: -210px;
    width: 200px;
    margin-left: -100%;
}
```

大家可以使用各种浏览器来测试一下这个示例 [圣杯：左栏固定主内容自适应](http://demo.doyoe.com/css/margin/layout/holy-grail.html)

一般情况下，你会发现除了`IE6`外，其它的浏览器看起来都算正常，然后问题的范围可能并不仅限于这些，大部分问题没被看出只不过是因为没到达边界。

问题列表：

* `IE6` 布局错乱，侧边栏位置不对；
* `IE7` resize窗口时，侧边栏会跳动；
* `IE7及其它浏览器`，当窗口缩小到主内容栏的宽度小于侧边栏的宽度时，布局错乱；

对于第3点，我们看看上述的代码实现，还是能非常轻松的理解的。因为侧边栏定义了 `margin-left: -100%`，在这个场景中，`100%` 其实就等同于主内容栏的宽度。如果主内容栏的宽度小于侧边栏，那么侧边栏偏移了一个比自己小的宽度，自然是放不下自己的。

对于第1点，这个就有点意思了，基本上这又算是IE6的一个Bug，描述一下这个Bug的现象：

在IE6中，假定是处于默认的书写模式下，当一个浮动的元素定义了margin的值是一个百分比，那么此时，浮动元素的margin百分比参照最近的清除了浮动的包含块的父元素的宽度进行计算，或者参照body。（然而标准描述只是参考包含块的宽度进行计算，详情请参阅我之前的文章 [margin系列之百分比](/2013/11/30/css/margin系列之百分比/)）

我会用一段伪代码来详述这个事，代码如下：

```html
body > c > b > a
```

假设上述代码中的 `a` 就是我们说的浮动元素，正常情况下 `a` 设置了一个百分比的margin，百分比是要参考 `b` 的宽度进行计算的。

然后 `IE6` 并没有实现这个规则，它的特征是：

* 浮动元素 `a` 定义了百分比的margin，假设它的祖先元素 `b` 和 `c` 都没有清除浮动，那么就会参照 `body` 的宽度进行百分比换算；
* 假设 `b` 清除了浮动，那么就会参照 `c` 的宽度进行百分比换算；

对于这个Bug，我写了一个示例，大家可以对照着描述来看这个例子：[浮动margin百分比在ie6上的Bug](http://demo.doyoe.com/css/margin/layout/margin-percentage-bug-on-ie6.html)

好了，知道了在 `IE6` 中有这个Bug之后，关于问题列表中的第1点，我们就也能够理解了，因为 `position: relative; left: -210px;` 这个定义对于 `IE6` 来讲，其实是多余的。

对于第2点，应该是在resize过程中，不断的重绘造成的，它需要不断的去计算这个百分比的使用值。

## 杀死它们

所以如果想使得圣杯布局变得更靠谱一些，我们要么就是见招拆招，修复这个问题（比如说为 `IE6` 重置掉 `position: relative; left: -210px;` 定义），要么就避免遇上这些问题，我更喜欢第二种的方式。